<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>QueueService.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Server</a> &gt; <a href="index.source.html" class="el_package">dev.coms4156.project.server.service</a> &gt; <span class="el_source">QueueService.java</span></div><h1>QueueService.java</h1><pre class="source lang-java linenums">package dev.coms4156.project.server.service;

import dev.coms4156.project.server.model.Queue;
import dev.coms4156.project.server.model.QueueStore;
import dev.coms4156.project.server.model.Result;
import dev.coms4156.project.server.model.Task;
import java.util.UUID;
import org.springframework.stereotype.Service;

/**
 * Service class that provides business logic for queue operations.
 * Acts as an intermediary between the controller layer and the data layer.
 */
@Service
public class QueueService {

  private final QueueStore queueStore;

  /**
   * Constructs a new QueueService with the default QueueStore instance.
   */
<span class="fc" id="L22">  public QueueService() {</span>
<span class="fc" id="L23">    this.queueStore = QueueStore.getInstance();</span>
<span class="fc" id="L24">  }</span>

  /**
   * Constructs a new QueueService with the specified QueueStore instance.
   * This constructor is primarily for testing purposes.
   *
   * @param queueStore the QueueStore instance to use
   */
<span class="nc" id="L32">  public QueueService(QueueStore queueStore) {</span>
<span class="nc" id="L33">    this.queueStore = queueStore;</span>
<span class="nc" id="L34">  }</span>

  /**
   * Creates a new queue with the given name.
   *
   * @param name the descriptive name for the queue
   * @return the newly created Queue instance
   * @throws IllegalArgumentException if the name is null or empty
   */
  public Queue createQueue(String name) {
<span class="fc bfc" id="L44" title="All 4 branches covered.">    if (name == null || name.isBlank()) {</span>
<span class="fc" id="L45">      throw new IllegalArgumentException(&quot;Queue name cannot be null or empty&quot;);</span>
    }
<span class="fc" id="L47">    return queueStore.createQueue(name.trim());</span>
  }

  /**
   * Adds a task to the specified queue.
   *
   * @param queueId the ID of the queue to add the task to
   * @param task the task to enqueue
   * @throws IllegalArgumentException if queueId is null/empty or task is null
   * @throws IllegalStateException if the queue with the given ID does not exist
   */
  public void enqueueTask(UUID queueId, Task task) {
<span class="fc" id="L59">    validateQueueId(queueId);</span>
<span class="fc bfc" id="L60" title="All 2 branches covered.">    if (task == null) {</span>
<span class="fc" id="L61">      throw new IllegalArgumentException(&quot;Task cannot be null&quot;);</span>
    }

<span class="fc" id="L64">    Queue queue = queueStore.getQueue(queueId);</span>
<span class="fc bfc" id="L65" title="All 2 branches covered.">    if (queue == null) {</span>
<span class="fc" id="L66">      throw new IllegalStateException(&quot;Queue with ID '&quot; + queueId + &quot;' does not exist&quot;);</span>
    }

<span class="fc" id="L69">    boolean success = queue.enqueue(task);</span>
<span class="pc bpc" id="L70" title="1 of 2 branches missed.">    if (!success) {</span>
<span class="nc" id="L71">      throw new IllegalStateException(&quot;Failed to enqueue task to queue '&quot; + queueId + &quot;'&quot;);</span>
    }
<span class="fc" id="L73">  }</span>

  /**
   * Retrieves and removes the highest priority task from the specified queue.
   * This method is typically called by workers to get their next task.
   *
   * @param queueId the ID of the queue to dequeue from
   * @return the highest priority task, or null if the queue is empty
   * @throws IllegalArgumentException if queueId is null or empty
   * @throws IllegalStateException if the queue with the given ID does not exist
   */
  public Task dequeueTask(UUID queueId) {
<span class="fc" id="L85">    validateQueueId(queueId);</span>

<span class="fc" id="L87">    Queue queue = queueStore.getQueue(queueId);</span>
<span class="fc bfc" id="L88" title="All 2 branches covered.">    if (queue == null) {</span>
<span class="fc" id="L89">      throw new IllegalStateException(&quot;Queue with ID '&quot; + queueId + &quot;' does not exist&quot;);</span>
    }

<span class="fc" id="L92">    Task task = queue.dequeue();</span>
<span class="fc bfc" id="L93" title="All 2 branches covered.">    if (task != null) {</span>
<span class="fc" id="L94">      task.setStatus(Task.TaskStatus.IN_PROGRESS);</span>
    }
<span class="fc" id="L96">    return task;</span>
  }

  /**
   * Submits a result for a completed task.
   *
   * @param queueId the ID of the queue the task belongs to
   * @param result the result to submit
   * @throws IllegalArgumentException if queueId is null/empty or result is null
   * @throws IllegalStateException if the queue with the given ID does not exist
   */
  public void submitResult(UUID queueId, Result result) {
<span class="fc" id="L108">    validateQueueId(queueId);</span>
<span class="fc bfc" id="L109" title="All 2 branches covered.">    if (result == null) {</span>
<span class="fc" id="L110">      throw new IllegalArgumentException(&quot;Result cannot be null&quot;);</span>
    }

<span class="fc" id="L113">    Queue queue = queueStore.getQueue(queueId);</span>
<span class="fc bfc" id="L114" title="All 2 branches covered.">    if (queue == null) {</span>
<span class="fc" id="L115">      throw new IllegalStateException(&quot;Queue with ID '&quot; + queueId + &quot;' does not exist&quot;);</span>
    }

<span class="fc" id="L118">    boolean success = queue.addResult(result);</span>
<span class="fc bfc" id="L119" title="All 2 branches covered.">    if (!success) {</span>
<span class="fc" id="L120">      throw new IllegalStateException(</span>
<span class="fc" id="L121">          &quot;Failed to submit result for task '&quot; + result.getTaskId() + &quot;'&quot;);</span>
    }
<span class="fc" id="L123">  }</span>

  /**
   * Retrieves the result for a specific task.
   *
   * @param queueId the ID of the queue the task belongs to
   * @param taskId the ID of the task to get the result for
   * @return the result if found, or null if no result exists for the task
   * @throws IllegalArgumentException if queueId or taskId is null
   * @throws IllegalStateException if the queue with the given ID does not exist
   */
  public Result getResult(UUID queueId, UUID taskId) {
<span class="fc" id="L135">    validateQueueId(queueId);</span>
<span class="fc bfc" id="L136" title="All 2 branches covered.">    if (taskId == null) {</span>
<span class="fc" id="L137">      throw new IllegalArgumentException(&quot;Task ID cannot be null&quot;);</span>
    }

<span class="fc" id="L140">    Queue queue = queueStore.getQueue(queueId);</span>
<span class="fc bfc" id="L141" title="All 2 branches covered.">    if (queue == null) {</span>
<span class="fc" id="L142">      throw new IllegalStateException(&quot;Queue with ID '&quot; + queueId + &quot;' does not exist&quot;);</span>
    }

<span class="fc" id="L145">    return queue.getResult(taskId);</span>
  }

  /**
   * Retrieves a queue by its ID.
   *
   * @param queueId the ID of the queue to retrieve
   * @return the Queue instance, or null if not found
   * @throws IllegalArgumentException if queueId is null or empty
   */
  public Queue getQueue(UUID queueId) {
<span class="fc" id="L156">    validateQueueId(queueId);</span>
<span class="fc" id="L157">    return queueStore.getQueue(queueId);</span>
  }

  /**
   * Checks if a queue exists with the given ID.
   *
   * @param queueId the ID to check
   * @return true if the queue exists, false otherwise
   * @throws IllegalArgumentException if queueId is null or empty
   */
  public boolean queueExists(UUID queueId) {
<span class="fc" id="L168">    validateQueueId(queueId);</span>
<span class="fc bfc" id="L169" title="All 2 branches covered.">    return queueStore.getQueue(queueId) != null;</span>
  }

  /**
   * Clears all queues from memory and triggers snapshot save.
   * This is an administrative operation that removes all queues, tasks, and results.
   */
  public void clearAll() {
<span class="fc" id="L177">    queueStore.clearAll();</span>
<span class="fc" id="L178">  }</span>

  /**
   * Gets the total number of queues currently in the store.
   *
   * @return the number of queues
   */
  public int getAllQueueCount() {
<span class="fc" id="L186">    return queueStore.getAllQueues().size();</span>
  }

  /**
   * Validates that a queue ID is not null or empty.
   *
   * @param queueId the queue ID to validate
   * @throws IllegalArgumentException if queueId is null or empty
   */
  private void validateQueueId(UUID queueId) {
<span class="fc bfc" id="L196" title="All 2 branches covered.">    if (queueId == null) {</span>
<span class="fc" id="L197">      throw new IllegalArgumentException(&quot;Queue ID cannot be null&quot;);</span>
    }
<span class="fc" id="L199">  }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>